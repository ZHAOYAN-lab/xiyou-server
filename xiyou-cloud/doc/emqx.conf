## NOTE:
## Configs in this file might be overridden by:
## 1. Environment variables which start with 'EMQX_' prefix
## 2. File $EMQX_NODE__DATA_DIR/configs/cluster-override.conf
## 3. File $EMQX_NODE__DATA_DIR/configs/local-override.conf
##
## The *-override.conf files are overwritten at runtime when changes
## are made from EMQX dashboard UI, management HTTP API, or CLI.
## All configuration details can be found in emqx.conf.example

node {
  name = "emqx@127.0.0.1"
  cookie = "emqxsecretcookie"
  data_dir = "/var/lib/emqx"
  process_limit = 2097152
  max_ports = 1048576
}

mqtt {
  max_packet_size = "5MB"
  max_inflight = 200
}

log {
  file_handlers.default {
    level = warning
    file = "/var/log/emqx/emqx.log"
  }
}

cluster {
  name = emqxcl
  discovery_strategy = manual
}


listeners.tcp.default {
  bind = "0.0.0.0:1883"
  acceptors = 64
  max_connections = 1024000
}

listeners.ssl.default {
  bind = "0.0.0.0:8883"
  max_connections = 512000
#  ssl_options {
#    keyfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.key"
#    certfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.pem"
#    cacertfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.pem"
#  }
}

listeners.ws.default {
  bind = "0.0.0.0:8083"
  max_connections = 1024000
  websocket.mqtt_path = "/mqtt"
}

listeners.wss.default {
  bind = "0.0.0.0:8084"
  max_connections = 512000
  websocket.mqtt_path = "/mqtt"
#  ssl_options {
#    keyfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.key"
#    certfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.pem"
#    cacertfile = "/etc/nginx/cert/cas-nginx-m.ifengniao.com/m.ifengniao.com.pem"
#  }
}

# listeners.quic.default {
#  enabled = true
#  bind = "0.0.0.0:14567"
#  max_connections = 1024000
#  keyfile = "/etc/emqx/certs/key.pem"
#  certfile = "/etc/emqx/certs/cert.pem"
#}

dashboard {
    listeners.http {
        bind = 18083
    }
    default_username = "admin"
    default_password = "public"
}

authorization {
  deny_action = ignore
  no_match = allow
  cache = { enable = true }
  sources =  [
    {
      type = file
      enable = true
      # This file is immutable to EMQX.
      # Once new rules are created from dashboard UI or HTTP API,
      # the file 'data/authz/acl.conf' is used instead of this one
      path = "/etc/emqx/acl.conf"
    }
  ]
}
